<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
       
      <meta name="keywords" content="wesker&#39;s blog" />
       
      <meta name="description" content="wesker&#39;s blog" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>Spring入门 |  wesker&#39;s blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/wei.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="wesker's blog" type="application/atom+xml">
</head>
  </html>
</html>




<body>
  <div id="app">
    
      
      <canvas width="1777" height="841"
        style="position: fixed; left: 0px; top: 0px; z-index: 99999; pointer-events: none;"></canvas>
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Spring"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  Spring入门
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/10/07/Spring/" class="article-date">
  <time datetime="2021-10-07T08:06:23.000Z" itemprop="datePublished">2021-10-07</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%AC%94%E8%AE%B0/">笔记</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">6.4k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">28 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Spring框架"><a href="#Spring框架" class="headerlink" title="Spring框架"></a>Spring框架</h1><h1 id="1-软件框架技术简介"><a href="#1-软件框架技术简介" class="headerlink" title="1.软件框架技术简介"></a>1.软件框架技术简介</h1><p>软件框架（software framework），通常指的是为了实现某个业界标准或完成特定基本任务的软件组件规范，也指为了实现某个软件组件规范时，提供规范所要求之基础功能的软件产品。</p>
<p>框架的功能类似于基础设施，与具体的软件应用无关，但是提供并实现最为基础的软件架构和体系。</p>
<p>1.为什么需要框架技术：</p>
<ol>
<li><p>帮我们更快更好地构建程序</p>
</li>
<li><p>是一个应用程序的半成品</p>
</li>
<li><p>提供可重用的公共结构</p>
</li>
<li><p>按一定规则组织的一组组件</p>
</li>
</ol>
<p>2.优势：</p>
<ol>
<li><p>不用再考虑公共问题</p>
</li>
<li><p>专心在业务实现上</p>
</li>
<li><p>结构统一，易于学习、维护</p>
</li>
<li><p>新手也可写出好程序</p>
</li>
</ol>
<p><code>不要重复造轮子（Stop Trying to Reinvent the Wheel），已经成为开发人员的基本原则。</code></p>
<p>Java世界中的主流框架技术： Spring、SpringMVC、MyBatis、Struts、Hibernate、SpringBoot等。</p>
<h1 id="2-Spring框架"><a href="#2-Spring框架" class="headerlink" title="2.Spring框架"></a>2.Spring框架</h1><h2 id="2-1-Spring框架简介"><a href="#2-1-Spring框架简介" class="headerlink" title="2.1.Spring框架简介"></a>2.1.Spring框架简介</h2><p>Spring是一个基于java的轻量级的、一站式框架。 虽然Spring是一个轻量级框架，但并不表示它的功能少。实际上，spring是一个庞然大物，包罗万象。 时至今日，Spring已经成为java世界中事实上的标准。</p>
<p>Spring之父：Rod Johnson(罗德.约翰逊) 他是悉尼大学音乐学博士，而计算机仅仅是学士学位。 由于Rod对JAVAEE笨重、臃肿的现状深恶痛绝，以至于他将他在JAVAEE实战中的经历称为噩梦般的经历。他决定改变这种现状，于是就有了Spring。</p>
<p><img src="/2021/10/07/Spring/1604979623519-f4d4da3a-8e02-4214-a746-0afbf118cdc5-163505409965110.png"></p>
<h2 id="2-2-Spring体系架构"><a href="#2-2-Spring体系架构" class="headerlink" title="2.2.Spring体系架构"></a>2.2.Spring体系架构</h2><p><img src="/2021/10/07/Spring/1604979623542-f6978c97-76d9-4158-8051-ce4f898bbcc4-16339465211622.png"></p>
<p>Spring 总共大约有 20 个模块，由 1300 多个不同的文件构成。而这些组件被分别整合在6 个模块中：</p>
<ol>
<li>核心容器（Core Container）</li>
<li>AOP（Aspect Oriented Programming）</li>
<li>设备支持（Instrmentation）</li>
<li>数据访问及集成（Data Access/Integeration）</li>
<li>Web报文发送（Messaging）</li>
<li>Test测试</li>
</ol>
<h2 id="2-3-Spring两大核心"><a href="#2-3-Spring两大核心" class="headerlink" title="2.3.Spring两大核心"></a>2.3.Spring两大核心</h2><p>DI：依赖注入（Dependency Injection） AOP：面向切面编程（Aspect Oriented Programming）</p>
<h1 id="3-DI（依赖注入）"><a href="#3-DI（依赖注入）" class="headerlink" title="3.DI（依赖注入）"></a>3.DI（依赖注入）</h1><p>依赖注入（Dependency Injection）是一种设计模式，也是Spring框架的核心概念之一。其作用是去除组件之间的依赖关系，实现解耦合。 也就是说：所谓依赖注入，是指工程中需要的组件无须自己创建，而是依赖于外部环境注入。</p>
<p>Spring实现依赖注入有三种方式：注解方式（官方推荐方式）、xml配置文件方式、javaConfig方式。</p>
<h2 id="3-1-使用xml实现DI"><a href="#3-1-使用xml实现DI" class="headerlink" title="3.1.使用xml实现DI"></a>3.1.使用xml实现DI</h2><p>下面使用 Spring 来重构dao层组件与service层组件。 也就是说：由Spring创建dao层组件和service层组件，并使用Spring将dao层组件注入给service层组件。</p>
<h3 id="3-1-1-添加Spring依赖"><a href="#3-1-1-添加Spring依赖" class="headerlink" title="3.1.1.添加Spring依赖"></a>3.1.1.添加Spring依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;<br>    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>    &lt;groupId&gt;com.neusoft&lt;/groupId&gt;<br>    &lt;artifactId&gt;springtest&lt;/artifactId&gt;<br>    &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;<br>    &lt;build&gt;<br>        &lt;plugins&gt;<br>            &lt;!-- 设置jdk版本 --&gt;<br>            &lt;plugin&gt;<br>                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br>                &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br>                &lt;configuration&gt;<br>                    &lt;source&gt;1.8&lt;/source&gt;<br>                    &lt;target&gt;1.8&lt;/target&gt;<br>                    &lt;encoding&gt;utf-8&lt;/encoding&gt;<br>                &lt;/configuration&gt;<br>            &lt;/plugin&gt;<br>        &lt;/plugins&gt;<br>    &lt;/build&gt;<br>    &lt;properties&gt;<br>        &lt;!-- spring 版本号 --&gt;<br>        &lt;spring.version&gt;5.2.8.RELEASE&lt;/spring.version&gt;<br>    &lt;/properties&gt;<br>    &lt;dependencies&gt;<br>        &lt;!-- 此依赖会关联引用Spring中的所有基础jar包 --&gt;<br>        &lt;dependency&gt;<br>            &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>            &lt;artifactId&gt;spring-context&lt;/artifactId&gt;<br>            &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;<br>        &lt;/dependency&gt;<br>    &lt;/dependencies&gt;<br>&lt;/project&gt;<br></code></pre></td></tr></table></figure>

<h3 id="3-1-2-创建dao接口与实现类"><a href="#3-1-2-创建dao接口与实现类" class="headerlink" title="3.1.2.创建dao接口与实现类"></a>3.1.2.创建dao接口与实现类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.dao;<br>import com.neusoft.po.User;<br>public interface UserDao &#123;<br>    public User getUser();<br>&#125;<br>package com.neusoft.dao.impl;<br>import com.neusoft.dao.UserDao;<br>import com.neusoft.po.User;<br>public class UserDaoImpl implements UserDao&#123;<br>    @Override<br>    public User getUser() &#123;<br>        return new User(1,&quot;test&quot;,&quot;111&quot;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-1-3-创建service接口与实现类"><a href="#3-1-3-创建service接口与实现类" class="headerlink" title="3.1.3.创建service接口与实现类"></a>3.1.3.创建service接口与实现类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.service;<br>import com.neusoft.po.User;<br>public interface UserService &#123;<br>    public User getUser();<br>&#125;<br>package com.neusoft.service.impl;<br>import com.neusoft.dao.UserDao;<br>import com.neusoft.po.User;<br>import com.neusoft.service.UserService;<br>public class UserServiceImpl implements UserService&#123;<br>    private UserDao userDao;<br>    @Override<br>    public User getUser() &#123;<br>        return userDao.getUser();<br>    &#125;<br>    public UserDao getUserDao() &#123;<br>        return userDao;<br>    &#125;<br>    public void setUserDao(UserDao userDao) &#123;<br>        this.userDao = userDao;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-1-4-创建Spring配置文件"><a href="#3-1-4-创建Spring配置文件" class="headerlink" title="3.1.4.创建Spring配置文件"></a>3.1.4.创建Spring配置文件</h3><p>在类路径下创建spring.xml配置文件：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;beans<br>    xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans <br>                    http://www.springframework.org/schema/beans/spring-beans.xsd<br>                    http://www.springframework.org/schema/context <br>                    http://www.springframework.org/schema/context/spring-context.xsd<br>                    http://www.springframework.org/schema/aop <br>                    http://www.springframework.org/schema/aop/spring-aop-4.1.xsd&quot;&gt;<br>    &lt;bean id=&quot;userDao&quot; class=&quot;com.neusoft.dao.impl.UserDaoImpl&quot;&gt;&lt;/bean&gt;<br>    &lt;bean id=&quot;userService&quot; class=&quot;com.neusoft.service.impl.UserServiceImpl&quot;&gt;<br>        &lt;property name=&quot;userDao&quot; ref=&quot;userDao&quot;/&gt;<br>    &lt;/bean&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure>

<ol>
<li><p>Spring配置文件就相当于一个容器。此容器中负责创建对象，并实现对象与对象之间的装配。</p>
</li>
<li><p>java中每一个类都是一个bean。所以上面的bean标签，就是在容器中创建一个java对象。</p>
</li>
<li><p>bean标签中的class属性，就是类名； id属性，就是对象名。</p>
</li>
<li><p>property标签，是给bean的属性注入其它对象。name属性，就是对象属性名； ref属性，就是给属性注入的对象。（如果想要注入基本数据类型，那么使用value属性）</p>
</li>
<li><p>给bean的属性注入其它对象，默认使用 get/set 方法注入。也可以使用其它方式注入：构造方法注入、P命名空间注入等。</p>
</li>
</ol>
<h3 id="3-1-5-测试"><a href="#3-1-5-测试" class="headerlink" title="3.1.5. 测试"></a>3.1.5. 测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft;<br>import org.springframework.context.ApplicationContext;<br>import org.springframework.context.support.ClassPathXmlApplicationContext;<br>import com.neusoft.po.User;<br>import com.neusoft.service.UserService;<br>public class MySpringTest &#123;<br>    public static void main(String[] args) &#123;<br>        //读取Spring配置文件,获取Spring容器<br>        ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>        //通过Spring容器的getBean方法获得对象<br>        UserService service = (UserService)context.getBean(&quot;userService&quot;);<br>        User user = service.getUser();<br>        System.out.println(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="3-2-使用注解实现DI"><a href="#3-2-使用注解实现DI" class="headerlink" title="3.2.使用注解实现DI"></a>3.2.使用注解实现DI</h2><p>注解（Annotation），也叫元数据。它是一种代码级别的说明，是jdk1.5之后引入的一个特性。</p>
<p>注解的作用：</p>
<ol>
<li><p>编写文档：通过代码里标识的元数据生成文档。</p>
</li>
<li><p>代码分析：通过代码里标识的元数据对代码进行分析。</p>
</li>
<li><p>编译检查：通过代码里标识的元数据让编译器能够实现基本的编译检查。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">//@Override就是一个编译检查注解<br>@Override<br>public int saveBusiness(String businessName) &#123;&#125;<br></code></pre></td></tr></table></figure>

<p>注解基本语法：@注解名称(属性=属性值)</p>
<h3 id="3-2-1-修改dao实现类"><a href="#3-2-1-修改dao实现类" class="headerlink" title="3.2.1.修改dao实现类"></a>3.2.1.修改dao实现类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.dao.impl;<br>import org.springframework.stereotype.Component;<br>import com.neusoft.dao.UserDao;<br>import com.neusoft.po.User;<br>@Component<br>public class UserDaoImpl implements UserDao&#123;<br>    @Override<br>    public User getUser() &#123;<br>        return new User(1,&quot;test&quot;,&quot;111&quot;);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>@Component：创建此类的对象，并放入到Spring容器中。 @Component(“xxxx”)：创建此类的对象，取一个对象名，并放入到Spring容器中。</p>
<h3 id="3-2-2-修改Service实现类"><a href="#3-2-2-修改Service实现类" class="headerlink" title="3.2.2.修改Service实现类"></a>3.2.2.修改Service实现类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.service.impl;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Component;<br>import com.neusoft.dao.UserDao;<br>import com.neusoft.po.User;<br>import com.neusoft.service.UserService;<br>@Component(&quot;userService&quot;)<br>public class UserServiceImpl implements UserService&#123;<br>    @Autowired<br>    private UserDao userDao;<br>    @Override<br>    public User getUser() &#123;<br>        return userDao.getUser();<br>    &#125;<br>    //注意：UserDao属性自动注入，所以就可以不用get/set方法了<br>&#125;<br></code></pre></td></tr></table></figure>

<p>@Autowired：默认按照类型在Spring容器寻找对象，并注入到属性中。 所以此时要注意：UserDao接口的实现类只能有一个。</p>
<h3 id="3-2-3-修改Spring配置文件"><a href="#3-2-3-修改Spring配置文件" class="headerlink" title="3.2.3.修改Spring配置文件"></a>3.2.3.修改Spring配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;beans<br>    xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans <br>                    http://www.springframework.org/schema/beans/spring-beans.xsd<br>                    http://www.springframework.org/schema/context <br>                    http://www.springframework.org/schema/context/spring-context.xsd<br>                    http://www.springframework.org/schema/aop <br>                    http://www.springframework.org/schema/aop/spring-aop-4.1.xsd&quot;&gt;<br>    &lt;!--开启注解扫描，设置需要扫描的包  --&gt;<br>    &lt;context:component-scan base-package=&quot;com.neusoft&quot;/&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure>

<p>context:component-scan标签中的base-package属性，设置需要扫描的包。 会到指定包（包括指定包下的所有子包）中扫描类、方法、属性上面是否有注解。（如有多个，可使用逗号分隔）</p>
<h3 id="3-2-4-测试"><a href="#3-2-4-测试" class="headerlink" title="3.2.4.测试"></a>3.2.4.测试</h3><p>测试类没有变化。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft;<br>import org.springframework.context.ApplicationContext;<br>import org.springframework.context.support.ClassPathXmlApplicationContext;<br>import com.neusoft.po.User;<br>import com.neusoft.service.UserService;<br>public class MySpringTest &#123;<br>    public static void main(String[] args) &#123;<br>        //读取Spring配置文件,获取Spring容器<br>        ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>        //通过Spring容器的getBean方法获得对象<br>        UserService service = (UserService)context.getBean(&quot;userService&quot;);<br>        User user = service.getUser();<br>        System.out.println(user);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-2-5-相关注解说明"><a href="#3-2-5-相关注解说明" class="headerlink" title="3.2.5.相关注解说明"></a>3.2.5.相关注解说明</h3><h4 id="3-2-5-1-组件级注解"><a href="#3-2-5-1-组件级注解" class="headerlink" title="3.2.5.1.组件级注解"></a>3.2.5.1.组件级注解</h4><p>除了@Component这个泛指组件的注解外，Spring还提供了与@Component功能相同的三个语义化注解。</p>
<ol>
<li><p>@Service 业务层组件</p>
</li>
<li><p>@Controller 控制层组件</p>
</li>
<li><p>@Repository 数据层组件</p>
</li>
</ol>
<p>修改上面代码，使用@Repository 和 @Service 替换 dao 与 service 组件上的注解。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">@Repository<br>public class UserDaoImpl implements UserDao&#123; &#125;<br>@Service(&quot;userService&quot;)<br>public class UserServiceImpl implements UserService&#123; &#125;<br></code></pre></td></tr></table></figure>

<h4 id="3-2-5-2-Bean作用范围注解"><a href="#3-2-5-2-Bean作用范围注解" class="headerlink" title="3.2.5.2.Bean作用范围注解"></a>3.2.5.2.Bean作用范围注解</h4><p>@Scope() 注解：设置Bean的作用域。值如下：</p>
<p><img src="/2021/10/07/Spring/1604979623533-7ee8e19c-f65f-4f35-8d43-3d1cb7789021.png"></p>
<p>在UserServiceImpl中添加@Scope注解：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">@Service(&quot;userService&quot;)<br>@Scope(&quot;prototype&quot;)<br>public class UserServiceImpl implements UserService&#123; &#125;<br></code></pre></td></tr></table></figure>

<p>在测试类中测试多例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>UserService service1 = (UserService)context.getBean(&quot;userService&quot;);<br>UserService service2 = (UserService)context.getBean(&quot;userService&quot;);<br>System.out.println(service1==service2);      //false<br></code></pre></td></tr></table></figure>

<h4 id="3-2-5-3-自动注入组件注解"><a href="#3-2-5-3-自动注入组件注解" class="headerlink" title="3.2.5.3.自动注入组件注解"></a>3.2.5.3.自动注入组件注解</h4><p>@Autowired 注解：默认按照类型自动给属性注入Spring容器中的对象。所以可以不取对象名。</p>
<p>如果需要按照对象名给属性注入，那么可以配合@Qualifier注解使用。</p>
<ol>
<li>首先，给UserDao取对象名</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs plain">@Repository(&quot;userDao&quot;)<br>public class UserDaoImpl implements UserDao&#123; &#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>使用@Qualifier通知@Autowired 注解，注入对象名为userDao的对象</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">@Autowired<br>@Qualifier(&quot;userDao&quot;)<br>private UserDao userDao;<br></code></pre></td></tr></table></figure>

<h2 id="3-3-使用javaConfig实现DI"><a href="#3-3-使用javaConfig实现DI" class="headerlink" title="3.3.使用javaConfig实现DI"></a>3.3.使用javaConfig实现DI</h2><p>javaConfig，是在 Spring 3.0 开始从一个独立的项目并入到 Spring 中的。javaConfig 可以看成一个用于完成 Bean 装配的 Spring 配置文件，即 Spring 容器，只不过该容器不是 XML文件，而是由程序员使用 java 自己编写的 java 类。</p>
<p>一个类中只要标注了@Configuration注解，这个类就可以为spring容器提供Bean定义的信息了，或者说这个类就成为一个spring容器了。</p>
<p>标注了@Configuration和标注了@Component的类一样是一个Bean，可以被Spring的 context:component-scan 标签扫描到。类中的每个标注了@Bean的方法都相当于提供了一个Bean的定义信息。</p>
<h3 id="3-3-1-创建javaConfig类"><a href="#3-3-1-创建javaConfig类" class="headerlink" title="3.3.1.创建javaConfig类"></a>3.3.1.创建javaConfig类</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft;<br>import org.springframework.beans.factory.annotation.Configurable;<br>import org.springframework.context.annotation.Bean;<br>import org.springframework.context.annotation.Configuration;<br>import com.neusoft.dao.UserDao;<br>import com.neusoft.dao.impl.UserDaoImpl;<br>import com.neusoft.service.UserService;<br>import com.neusoft.service.impl.UserServiceImpl;<br>@Configuration<br>public class AppConfig &#123;<br>    @Bean<br>    public UserDao userDao() &#123;<br>        return new UserDaoImpl();<br>    &#125;<br>    @Bean<br>    public UserService userService() &#123;<br>        //这里不能声明接口类型<br>        UserServiceImpl userService = new UserServiceImpl();<br>        //配置依赖关系（需要set方法）<br>        userService.setUserDao(userDao());<br>        return userService;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="3-3-2-测试"><a href="#3-3-2-测试" class="headerlink" title="3.3.2.测试"></a>3.3.2.测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>UserService service = (UserService)context.getBean(&quot;userService&quot;);<br>User user = service.getUser();<br>System.out.println(user);<br></code></pre></td></tr></table></figure>

<h2 id="3-4-BeanFactory与ApplicationContext"><a href="#3-4-BeanFactory与ApplicationContext" class="headerlink" title="3.4.BeanFactory与ApplicationContext"></a>3.4.BeanFactory与ApplicationContext</h2><p>获取Spring容器也可以使用BeanFactory接口。BeanFactory与ApplicationContext的区别是：</p>
<ol>
<li>BeanFactory<br>Bean工厂（org.springframework.beans.factory.BeanFactory）是Spring框架最核心的接口，提供了IoC的配置机制，使管理不同类型的Java对象成为可能。特点是：采用延迟加载Bean，直到第一次使用Bean实例时才会创建Bean。</li>
<li>ApplicationContext<br>应用上下文（org.springframework.context.ApplicationContext），继承自BeanFactory，提供了更多面向应用的功能，比如国际化支持、框架事件体系，更易于创建实际应用。</li>
</ol>
<p>应用时，我们一般称BeanFactory为IoC容器，ApplicationContext为应用上下文：</p>
<ol>
<li><p>BeanFactory是Spring框架的基础设施，面向Spring本身；</p>
</li>
<li><p>ApplicationContext面向使用Spring框架的开发者；</p>
</li>
<li><p>几乎所有的应用场合都可以直接使用ApplicationContext而非底层的BeanFactory;</p>
</li>
</ol>
<h2 id="3-5-IOC与DI"><a href="#3-5-IOC与DI" class="headerlink" title="3.5.IOC与DI"></a>3.5.IOC与DI</h2><p>IOC：控制反转（Inversion of Control）：它是一种控制权的转移。即组件与组件之间的依赖由主动变为被动。也就是说：应用程序本身不再负责组件的创建、维护等，而是将控制权移交出去。从这一点来说，几乎所有的框架都是IOC框架。</p>
<p>DI：依赖注入（Dependency Injection）：依赖其他容器（比如spring）来创建和维护所需要的组件，并将其注入到应用程序中。</p>
<p>IOC只是将组件控制权移交出去，但并没有说明组件如何获取。而DI明确说明：组件依赖Spring容器获取。 所以可以这样说：DI是IOC思想的一种具体实现。</p>
<h1 id="4-AOP（面向切面）"><a href="#4-AOP（面向切面）" class="headerlink" title="4.AOP（面向切面）"></a>4.AOP（面向切面）</h1><p>AOP：全称是 Aspect Oriented Programming 即：面向切面编程。</p>
<p>简单的说它就是把我们程序重复的代码抽取出来，在需要执行的时候，使用动态代理的技术，在不修改源码的基础上，对我们的已有方法进行增强。</p>
<p>即当需要扩展功能时，传统方式采用纵向继承方式实现。但这种方式有很多缺点。 比如：父类方法名称改变时，子类也要修改。给多个方法扩展功能时，子类也需要修改。 因此，spring的AOP，实际上是采用横向抽取机制，取代传统的纵向继承体系。</p>
<p>实现AOP示意图：</p>
<ol>
<li>先将方面代码抽取出来<br><img src="/2021/10/07/Spring/1604979623887-9e3b1c96-0dcf-46e2-ad14-238af06d56dd-16350540996446.png"></li>
<li>运行时将业务代码和方面代码编织在一起<br><img src="/2021/10/07/Spring/1604979623883-6aaf0e7d-d06c-45ca-928c-3d9cdb5aca49-16350540996444.png"></li>
</ol>
<p>Spring AOP 可以使用xml文件形式实现，也可以使用注解方式实现。下面只使用注解方式实现Spring AOP。</p>
<h2 id="4-1-使用注解方式实现AOP"><a href="#4-1-使用注解方式实现AOP" class="headerlink" title="4.1.使用注解方式实现AOP"></a>4.1.使用注解方式实现AOP</h2><p>下面例子功能为：在运行业务方法前，输出一段日志。</p>
<h3 id="4-1-1-添加aspectj依赖"><a href="#4-1-1-添加aspectj依赖" class="headerlink" title="4.1.1.添加aspectj依赖"></a>4.1.1.添加aspectj依赖</h3><p>Aspectj是一个基于java的、面向切面的AOP框架。Spring2.0之后增加了对Aspectj切点表达式的支持。而实际开发中一般都使用Aspectj方式来实现AOP。所以还要导入Aspectj相关jar包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;dependency&gt;<br>    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;<br>    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;<br>    &lt;version&gt;1.8.7&lt;/version&gt;<br>&lt;/dependency&gt;<br></code></pre></td></tr></table></figure>

<h3 id="4-1-2-抽取方面代码封装通知对象"><a href="#4-1-2-抽取方面代码封装通知对象" class="headerlink" title="4.1.2.抽取方面代码封装通知对象"></a>4.1.2.抽取方面代码封装通知对象</h3><p>在实际开发中，除了业务逻辑这个主要功能之外，还需要处理许多辅助功能。 比如：日志、异常处理、事务、输入验证、安全等等，我们将这些代码称为：<strong>方面代码</strong>。而方面代码，就是我们要抽取出来的。</p>
<p>下面抽取日志方面代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.advice;<br>import org.aspectj.lang.JoinPoint;<br>import org.aspectj.lang.annotation.Aspect;<br>import org.aspectj.lang.annotation.Before;<br>import org.springframework.stereotype.Component;<br>@Component<br>@Aspect     //@Aspect定义此类为方面代码，即是一个通知。<br>public class MyAdvice &#123;<br>    @Before(&quot;execution(* com.neusoft.service.impl.*.*(..))&quot;)<br>    public void beforeMethod(JoinPoint joinpoint)&#123;<br>        System.out.println(&quot;【前置通知日志】&quot; + joinpoint.toString());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li><p>@Aspect注解：定义此类为方面代码，即是一个通知。</p>
</li>
<li><p>@Before注解：定义一个前置通知。即在目标方法执行前切入此注解标注的方法。</p>
</li>
<li><p>execution() 是一个Aspect表达式，语法为：execution(返回值类型 包名.类名.方法名 (参数) 异常)</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">/*<br> * 例如：execution(* com.neusoft.service.impl.*.*(..))<br> * 第一个 *：所有的返回值类型<br> * 第二个 *：所有的类<br> * 第三个 *：所有的方法<br> * 第四个 .. ：所有的参数<br> */<br></code></pre></td></tr></table></figure>

<h3 id="4-1-3-修改Spring配置文件"><a href="#4-1-3-修改Spring配置文件" class="headerlink" title="4.1.3.修改Spring配置文件"></a>4.1.3.修改Spring配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;<br>&lt;beans<br>    xmlns=&quot;http://www.springframework.org/schema/beans&quot;<br>    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;<br>    xmlns:aop=&quot;http://www.springframework.org/schema/aop&quot;<br>    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;<br>    xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans <br>                    http://www.springframework.org/schema/beans/spring-beans.xsd<br>                    http://www.springframework.org/schema/context <br>                    http://www.springframework.org/schema/context/spring-context.xsd<br>                    http://www.springframework.org/schema/aop <br>                    http://www.springframework.org/schema/aop/spring-aop-4.1.xsd&quot;&gt;<br>    &lt;!--开启注解扫描，设置需要扫描的包  --&gt;<br>    &lt;context:component-scan base-package=&quot;com.neusoft&quot;/&gt;<br>    &lt;!-- 声明自动为spring容器中那些配置@Aspect切面的bean创建代理，织入切面。 --&gt;<br>    &lt;aop:aspectj-autoproxy/&gt;<br>&lt;/beans&gt;<br></code></pre></td></tr></table></figure>

<p>aop:aspectj-autoproxy标签：声明自动为spring容器中那些配置@Aspect切面的bean创建代理，织入切面。</p>
<h3 id="4-1-4-测试"><a href="#4-1-4-测试" class="headerlink" title="4.1.4.测试"></a>4.1.4.测试</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs plain">public static void main(String[] args) &#123;<br>    //读取Spring配置文件,获取Spring容器<br>    ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>    //通过Spring容器的getBean方法获得对象<br>    UserService service = (UserService)context.getBean(&quot;userService&quot;);<br>    User user = service.getUser();<br>    System.out.println(user);<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="4-2-五种通知类型"><a href="#4-2-五种通知类型" class="headerlink" title="4.2.五种通知类型"></a>4.2.五种通知类型</h2><p>方面代码一般也称为通知：定义一个“切面”要实现的功能。通知有五种：</p>
<ol>
<li><p>前置通知：在某连接点（JoinPoint 就是要织入的业务方法）之前执行的通知。</p>
</li>
<li><p>后置通知：当某连接点退出时执行的通知（不论是正常结束还是发生异常）。</p>
</li>
<li><p>返回通知：（最终通知）在这里可以得到业务方法的返回值。但在发生异常时无法得到返回值。</p>
</li>
<li><p>环绕通知：包围一个连接点的通知，也就是在业务方法执行前和执行后执行的通知。</p>
</li>
<li><p>异常通知：在业务方法发生异常时执行的通知。</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.advice;<br>import org.aspectj.lang.JoinPoint;<br>import org.aspectj.lang.ProceedingJoinPoint;<br>import org.aspectj.lang.annotation.After;<br>import org.aspectj.lang.annotation.AfterReturning;<br>import org.aspectj.lang.annotation.AfterThrowing;<br>import org.aspectj.lang.annotation.Around;<br>import org.aspectj.lang.annotation.Aspect;<br>import org.aspectj.lang.annotation.Before;<br>import org.aspectj.lang.annotation.Pointcut;<br>import org.springframework.stereotype.Component;<br>@Component<br>@Aspect<br>public class MyAdvice &#123;<br>    //定义通用Aspect表达式，下面通知方法就可以引用此方法的规则了<br>    @Pointcut(&quot;execution(* com.neusoft.service.impl.*.*(..))&quot;)<br>    private void anyMethod()&#123;&#125;<br>    @Before(&quot;anyMethod()&quot;)<br>    public void beforeMethod(JoinPoint joinpoint)&#123;<br>        System.out.println(&quot;【前置通知日志】&quot; + joinpoint.toString());<br>    &#125;<br>    @After(&quot;anyMethod()&quot;)<br>    public void afterMethod(JoinPoint joinpoint)&#123;<br>        System.out.println(&quot;后置通知日志&quot; + joinpoint.toString());<br>    &#125;<br>    @AfterReturning(pointcut=&quot;anyMethod()&quot;,returning=&quot;result&quot;)<br>    public void afterReturnning(JoinPoint joinpoint,Object result)&#123;<br>        System.out.println(&quot;返回通知日志&quot; + joinpoint.toString());<br>    &#125;<br>    @AfterThrowing(pointcut=&quot;anyMethod()&quot;,throwing=&quot;ex&quot;)<br>    public void afterThrowing(JoinPoint joinpoint,Exception ex)&#123;<br>        System.out.println(&quot;异常通知日志&quot; + joinpoint.toString());<br>    &#125;<br>    @Around(&quot;anyMethod()&quot;)<br>    public Object aroundMethod(ProceedingJoinPoint pjp) &#123;<br>        Object obj = null;<br>        try&#123;<br>            System.out.println(&quot;环绕通知日志&quot; + pjp.toString());<br>            obj = pjp.proceed();<br>        &#125;catch(Throwable e)&#123;<br>            e.printStackTrace();<br>        &#125;<br>        return obj;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li><p>如果配置了环绕通知，那么业务方法的执行将在环绕通知中的obj = pjp.proceed();这段代码时开始执行。此时要注意：如果环绕通知方法不写返回值，或者obj = pjp.proceed()这段代码如果不取得返回值，那么返回通知也不能取得返回值。</p>
</li>
<li><p>有了环绕通知，异常通知也将失去作用。</p>
</li>
<li><p>实际上，如果要配置环绕通知，那么其他通知就失去意义了。因为在环绕通知中，也可以在方法执行前、执行后做方面代码，包括获取返回值、做异常处理等。</p>
</li>
</ol>
<h2 id="4-3-Spring动态代理的两种形式"><a href="#4-3-Spring动态代理的两种形式" class="headerlink" title="4.3.Spring动态代理的两种形式"></a>4.3.Spring动态代理的两种形式</h2><h3 id="4-3-1-两种动态代理"><a href="#4-3-1-两种动态代理" class="headerlink" title="4.3.1.两种动态代理"></a>4.3.1.两种动态代理</h3><p>动态代理是一种常用的设计模式，广泛应用于框架中，Spring框架的AOP特性就是应用动态代理实现的。</p>
<p><img src="/2021/10/07/Spring/1604979623912-ddd3cc33-6d61-4fae-b0e3-80d7a9b0c720-16350540996458.png"></p>
<p>实现动态代理有两种形式：</p>
<ol>
<li>jdk动态代理：根据目标类接口获取代理类实现规则，生成代理对象。这个代理对象，也是目标类接口的一个实现类。</li>
<li>cglib动态代理：根据目标类本身获取代理类实现规则，生成代理对象。这个代理对象，也是目标类的一个子类。 （如果目标类为final，则不能使用CGLib实现动态代理）</li>
</ol>
<p>SpringAOP可以自动在jdk动态代理和CGLib动态代理之间进行切换，规则如下：</p>
<ol>
<li><p>如果目标对象实现了接口，采用jdk动态代理实现aop。</p>
</li>
<li><p>如果目标对象没有实现接口，采用CGLib动态代理实现aop。</p>
</li>
<li><p>如果目标对象实现了接口，但仍然想要使用CGLIB实现aop，可以手动进行配置。</p>
</li>
</ol>
<h3 id="4-3-2-性能测试"><a href="#4-3-2-性能测试" class="headerlink" title="4.3.2.性能测试"></a>4.3.2.性能测试</h3><p>我们通过获取执行代码所耗费的时间，来实际测试两种动态代理方式的性能对比。</p>
<ol>
<li>jdk动态代理测试：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">public static void main(String[] args) &#123;<br>    ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>    long begin = System.currentTimeMillis();<br>    //使用接口<br>    UserService service = (UserService)context.getBean(&quot;userService&quot;);<br>    User user = service.getUser();<br>    long end = System.currentTimeMillis();<br>    System.out.println(&quot;执行时间：&quot;+(end-begin));<br>&#125;<br></code></pre></td></tr></table></figure>

<ol>
<li>cglib动态代理测试：</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs plain">public static void main(String[] args) &#123;<br>    ApplicationContext context = new  ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>    long begin = System.currentTimeMillis();<br>    //不使用接口<br>    UserServiceImpl service = (UserServiceImpl)context.getBean(&quot;userService&quot;);<br>    User user = service.getUser();<br>    long end = System.currentTimeMillis();<br>    System.out.println(&quot;执行时间：&quot;+(end-begin));<br>&#125;<br></code></pre></td></tr></table></figure>

<p>注意：</p>
<ol>
<li>dao层不能再实现接口。</li>
<li>service层不能再实现接口。</li>
</ol>
<h1 id="5-Spring集成MyBatis"><a href="#5-Spring集成MyBatis" class="headerlink" title="5.Spring集成MyBatis"></a>5.Spring集成MyBatis</h1><p>所谓的Spring集成MyBatis，就是由Spring给MyBatis注入需要的组件。比如：DataSource（数据源）、SqlSessionFactory、sqlSession、事务管理对象等。</p>
<h2 id="5-1-添加集成MyBatis的依赖"><a href="#5-1-添加集成MyBatis的依赖" class="headerlink" title="5.1.添加集成MyBatis的依赖"></a>5.1.添加集成MyBatis的依赖</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;properties&gt;<br>    &lt;spring.version&gt;5.2.8.RELEASE&lt;/spring.version&gt;<br>&lt;/properties&gt;<br>&lt;dependencies&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;<br>        &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;!--spring对jdbc的支持依赖包（关联spring-tx包） --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.springframework&lt;/groupId&gt;<br>        &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;<br>        &lt;version&gt;$&#123;spring.version&#125;&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;!-- mybatis-spring 依赖包 --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;<br>        &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;<br>        &lt;version&gt;2.0.0&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;!--mybatis 依赖包 --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;org.mybatis&lt;/groupId&gt;<br>        &lt;artifactId&gt;mybatis&lt;/artifactId&gt;<br>        &lt;version&gt;3.5.1&lt;/version&gt;<br>    &lt;/dependency&gt;<br>    &lt;!-- mysql驱动 依赖包 --&gt;<br>    &lt;dependency&gt;<br>        &lt;groupId&gt;mysql&lt;/groupId&gt;<br>        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>        &lt;version&gt;5.1.6&lt;/version&gt;<br>    &lt;/dependency&gt;<br>&lt;/dependencies&gt;<br></code></pre></td></tr></table></figure>

<h2 id="5-2-创建Mapper"><a href="#5-2-创建Mapper" class="headerlink" title="5.2.创建Mapper"></a>5.2.创建Mapper</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs plain">package com.neusoft.ms.mapper;<br>import org.apache.ibatis.annotations.Mapper;<br>import org.apache.ibatis.annotations.Select;<br>import org.apache.ibatis.annotations.Update;<br>import com.neusoft.ms.po.Emp;<br>@Mapper<br>public interface EmpMapper &#123;<br>    @Select(&quot;select * from emp where empno=#&#123;empno&#125;&quot;)<br>    public Emp getEmpById(int empno);<br>&#125;<br></code></pre></td></tr></table></figure>

<p>在Mapper接口上添加@Mapper注解，Spring容器扫描到此注解后，就会将SqlSession注入给Mapper组件。</p>
<h2 id="5-3-添加db-properties文件"><a href="#5-3-添加db-properties文件" class="headerlink" title="5.3.添加db.properties文件"></a>5.3.添加db.properties文件</h2><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">jdbc.driver</span>=com.mysql.cj.jdbc.Driver<br><span class="hljs-attr">jdbc.url</span>=jdbc:mysql://localhost:<span class="hljs-number">3306</span>/elm?useSSL=<span class="hljs-literal">false</span>&amp;allowPublicKeyRetrieval=<span class="hljs-literal">true</span>&amp;serverTimezone=UTC<br><span class="hljs-attr">jdbc.username</span>=root<br><span class="hljs-attr">jdbc.password</span>=<span class="hljs-number">486934.0</span><br></code></pre></td></tr></table></figure>

<h2 id="5-4-Spring容器中添加组件"><a href="#5-4-Spring容器中添加组件" class="headerlink" title="5.4.Spring容器中添加组件"></a>5.4.Spring容器中添加组件</h2><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="xml"><span class="hljs-comment">&lt;!--开启注解扫描，设置需要扫描的包（用于扫描测试时用的Service组件）  --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:component-scan</span> <span class="hljs-attr">base-package</span>=<span class="hljs-string">&quot;com.foreknow&quot;</span>/&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- 引入db配置文件  --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">context:property-placeholder</span> <span class="hljs-attr">location</span>=<span class="hljs-string">&quot;classpath:db.properties&quot;</span> /&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- 配置dataSource数据源 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;dataSource&quot;</span></span></span><br><span class="hljs-tag"><span class="xml">      <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;driverClassName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.driver&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;url&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.url&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.username&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$</span></span></span><span class="hljs-template-variable">&#123;jdbc.password&#125;</span><span class="xml"><span class="hljs-tag"><span class="hljs-string">&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- 创建SqlSessionFactory，并配置实体对象别名 --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;dataSource&quot;</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;dataSource&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;typeAliasesPackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.neusoft.ms.po&quot;</span> /&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br><span class="xml"><span class="hljs-comment">&lt;!-- 配置Mapper，自动扫描Mapper接口，并为其注入SqlSessionFactory --&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">bean</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;basePackage&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;com.foreknow.mapper&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml">    <span class="hljs-tag">&lt;<span class="hljs-name">property</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;sqlSessionFactory&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">property</span>&gt;</span></span><br><span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">bean</span>&gt;</span></span><br></code></pre></td></tr></table></figure>

<h2 id="5-5-测试"><a href="#5-5-测试" class="headerlink" title="5.5.测试"></a>5.5.测试</h2><p>创建Service组件，然后测试</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-meta">@Service</span>(<span class="hljs-string">&quot;userService&quot;</span>)<br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserService</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-function">User <span class="hljs-title">getEmpById</span><span class="hljs-params">(String UserId)</span> </span>&#123;<br>        <span class="hljs-function"><span class="hljs-keyword">return</span> userMapper.<span class="hljs-title">getUserByUserId</span><span class="hljs-params">(UserId)</span></span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-built_in">public</span> static <span class="hljs-type">void</span> main(String[] args)&#123;<br>    ApplicationContext context = <span class="hljs-built_in">new</span> ClassPathXmlApplicationContext(&quot;spring.xml&quot;);<br>    UserService userService = (UserService) context.getBean(&quot;userService&quot;);<br>    <span class="hljs-keyword">User</span> <span class="hljs-keyword">user</span> = userService.getEmpById(&quot;11111111111&quot;);<br>    <span class="hljs-keyword">System</span>.<span class="hljs-keyword">out</span>.println(<span class="hljs-keyword">user</span>.toString());<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5-6-添加事务管理"><a href="#5-6-添加事务管理" class="headerlink" title="5.6.添加事务管理"></a>5.6.添加事务管理</h2><p>Spring为了支持事务管理，专门封装了事务管理对象。我们只要在Spring容器中配置这个对象，即可使用。</p>
<p>在Spring容器中添加事务管理的配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs plain">&lt;!-- 配置Spring提供的事务管理器 --&gt;<br>&lt;bean id=&quot;transactionManager&quot;<br>    class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;<br>    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;&gt;&lt;/property&gt;<br>&lt;/bean&gt;<br>&lt;!-- 开启注解事务 --&gt;<br>&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot; /&gt;<br></code></pre></td></tr></table></figure>

<p>在Service组件中，使用@Transactional注解，就可以给业务方法添加事务管理。</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-variable">@Service</span>(<span class="hljs-string">&quot;userService&quot;</span>)<br>public class UserServiceImpl implements UserService &#123;<br>    <span class="hljs-variable">@Autowired</span><br>    private UserMapper userMapper;<br>    <span class="hljs-variable">@Override</span><br>    <span class="hljs-variable">@Transactional</span><br>    public User getEmpById(String UserId) &#123;<br>        <span class="hljs-selector-tag">return</span> <span class="hljs-selector-tag">userMapper</span><span class="hljs-selector-class">.getUserByUserId</span>(UserId);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<blockquote>
<p>注意：</p>
<ol>
<li>需要事务管理的service，在方法上加上@Transactional 注解即可。</li>
<li>必须为public方法才行,不要捕捉异常，要让异常自动抛出，否则不能进行事务回滚。</li>
</ol>
</blockquote>
<h2 id="5-7-事务传播行为"><a href="#5-7-事务传播行为" class="headerlink" title="5.7.事务传播行为"></a>5.7.事务传播行为</h2><p>@Transactional 注解中的 propagation 属性，可以设置事务传播行为。属性值为：</p>
<ol>
<li>REQUIRED：如果当前没有事务，就新建一个事务，如果已经存在一个事务中，就加入到这个事务中。这是最常见的选择。</li>
<li>SUPPORTS：支持当前事务，如果当前没有事务，就以非事务方式执行。</li>
<li>MANDATORY：使用当前的事务，如果当前没有事务，就抛出异常。</li>
<li>REQUIRES_NEW：新建事务，如果当前存在事务，把当前事务挂起。</li>
<li>NOT_SUPPORTED：以非事务方式执行操作，如果存在事务，就把当前事务挂起。</li>
<li>NEVER：以非事务方式执行，如果当前存在事务，则抛出异常。</li>
</ol>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Java/" rel="tag">Java</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spring/" rel="tag">Spring</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%A1%86%E6%9E%B6/" rel="tag">框架</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2021/10/25/SpringMVC/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            SpringMVC
          
        </div>
      </a>
    
    
      <a href="/2021/10/06/Springboot/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Springboot入门</div>
      </a>
    
  </nav>

   
<!-- valine评论 -->
<div id="vcomments-box">
  <div id="vcomments"></div>
</div>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/valine@1.4.14/dist/Valine.min.js"></script>
<script>
  new Valine({
    el: "#vcomments",
    app_id: "ro9ik0ujr5xEuCjVNSOaDGX0-gzGzoHsz",
    app_key: "5TUjb1R3rddvH9AXsn1OAIDP",
    path: window.location.pathname,
    avatar: "monsterid",
    placeholder: "给我的文章加点评论吧~",
    recordIP: true,
  });
  const infoEle = document.querySelector("#vcomments .info");
  if (infoEle && infoEle.childNodes && infoEle.childNodes.length > 0) {
    infoEle.childNodes.forEach(function (item) {
      item.parentNode.removeChild(item);
    });
  }
</script>
<style>
  #vcomments-box {
    padding: 5px 30px;
  }

  @media screen and (max-width: 800px) {
    #vcomments-box {
      padding: 5px 0px;
    }
  }

  #vcomments-box #vcomments {
    background-color: #fff;
  }

  .v .vlist .vcard .vh {
    padding-right: 20px;
  }

  .v .vlist .vcard {
    padding-left: 10px;
  }
</style>

 
   
     
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> wesker
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/wei.ico" alt="wesker&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/img/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->
 
<script src="/js/clickBoom2.js"></script>
 
<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>